(function(b){b.fn.formbuilder=function(j){var c=b.extend({save_url:!1,load_url:!1,control_box_target:!1,serialize_prefix:"frmb",messages:{save:"Save",add_new_field:"Add New Field...",text:"Text Field",title:"Title",paragraph:"Paragraph",checkboxes:"Checkboxes",radio:"Radio",select:"Select List",text_field:"Text Field",label:"Label",paragraph_field:"Paragraph Field",select_options:"Select Options",add:"Add",checkbox_group:"Checkbox Group",remove_message:"Are you sure you want to remove this element?",
remove:"Remove",radio_group:"Radio Group",selections_message:"Allow Multiple Selections",hide:"Hide",required:"Required",show:"Show"}},j),e="frmb-"+b("ul[id^=frmb-]").length++;return this.each(function(){var f=b(this).append('<ul id="'+e+'" class="frmb"></ul>').find("ul"),a="",j="",h=1,g,l;b(f).addClass(e);c.load_url&&b.getJSON(c.load_url,function(a){l=a.form_id;r(a.form_structure)});(function(a){var d,o=d="",p=e+"-control-box",g=e+"-save-button";d=""+('<option value="0">'+c.messages.add_new_field+
"</option>");d+='<option value="input_text">'+c.messages.text+"</option>";d+='<option value="textarea">'+c.messages.paragraph+"</option>";d+='<option value="checkbox">'+c.messages.checkboxes+"</option>";d+='<option value="radio">'+c.messages.radio+"</option>";d+='<option value="select">'+c.messages.select+"</option>";d='<select id="'+p+'" class="frmb-control">'+d+"</select>";o='<input type="submit" id="'+g+'" class="frmb-submit" value="'+c.messages.save+'"/>';a?b(a).append(d):b(f).before(d);b(f).after(o);
b("#"+g).click(function(){s();return!1});b("#"+p).change(function(){q(b(this).val());b(this).val(0).blur();b("html, body").animate({scrollTop:b("#frm-"+(h-1)+"-item").offset().top},500);return!1})})(c.control_box_target);var r=function(a){var c="",e=!1;b(a).each(function(){"checkbox"===this.cssClass?(e=[this.title],c=[],b.each(this.values,function(){c.push([this.value,this.baseline])})):"radio"===this.cssClass?(e=[this.title],c=[],b.each(this.values,function(){c.push([this.value,this.baseline])})):
"select"===this.cssClass?(e=[this.title,this.multiple],c=[],b.each(this.values,function(){c.push([this.value,this.baseline])})):c=[this.values];q(this.cssClass,c,e,this.required)})},q=function(b,d,e,f){a="";j=b;"undefined"===typeof d&&(d="");switch(b){case "input_text":a+="<label>"+c.messages.label+"</label>";a+='<input class="fld-title" id="title-'+h+'" type="text" value="'+d+'" />';g="";m(c.messages.text,a,f,g);break;case "textarea":a+="<label>"+c.messages.label+"</label>";a+='<input type="text" value="'+
d+'" />';g="";m(c.messages.paragraph_field,a,f,g);break;case "checkbox":b=d;d="";"object"===typeof e&&(d=e[0]);a+='<div class="chk_group">';a+='<div class="frm-fld"><label>'+c.messages.title+"</label>";a+='<input type="text" name="title" value="'+d+'" /></div>';a+='<div class="false-label">'+c.messages.select_options+"</div>";a+='<div class="fields">';if("object"===typeof b)for(i=0;i<b.length;i++)a+=n(b[i]);else a+=n("");a+='<div class="add-area"><a href="#" class="add add_ck">'+c.messages.add+"</a></div>";
a+="</div>";a+="</div>";g="";m(c.messages.checkbox_group,a,f,g);break;case "radio":b=d;d="";"object"===typeof e&&(d=e[0]);a+='<div class="rd_group">';a+='<div class="frm-fld"><label>'+c.messages.title+"</label>";a+='<input type="text" name="title" value="'+d+'" /></div>';a+='<div class="false-label">'+c.messages.select_options+"</div>";a+='<div class="fields">';if("object"===typeof b)for(i=0;i<b.length;i++)a+=k(b[i],"frm-"+h+"-fld");else a+=k("","frm-"+h+"-fld");a+='<div class="add-area"><a href="#" class="add add_rd">'+
c.messages.add+"</a></div>";a+="</div>";a+="</div>";g="";m(c.messages.radio_group,a,f,g);break;case "select":var b=d,d=!1,l="";"object"===typeof e&&(l=e[0],d="true"===e[1]?!0:!1);a+='<div class="opt_group">';a+='<div class="frm-fld"><label>'+c.messages.title+"</label>";a+='<input type="text" name="title" value="'+l+'" /></div>';a+="";a+='<div class="false-label">'+c.messages.select_options+"</div>";a+='<div class="fields">';a+='<input type="checkbox" name="multiple"'+(d?'checked="checked"':"")+">";
a+='<label class="auto">'+c.messages.selections_message+"</label>";if("object"===typeof b)for(i=0;i<b.length;i++)a+=d?n(b[i]):k(b[i]);else a+=d?n(""):k("");a+='<div class="add-area"><a href="#" class="add add_opt">'+c.messages.add+"</a></div>";a+="</div>";a+="</div>";g="";m(c.messages.select,a,f,g)}},n=function(b){var d=!1,e="";"object"===typeof b&&(e=b[0],d="false"===b[1]||"undefined"===b[1]?!1:!0);a="";a+="<div>";a+='<input type="checkbox"'+(d?' checked="checked"':"")+" />";a+='<input type="text" value="'+
e+'" />';a+='<a href="#" class="remove" title="'+c.messages.remove_message+'">'+c.messages.remove+"</a>";return a+="</div>"},k=function(b,d){var e=!1,f="";"object"===typeof b&&(f=b[0],e="false"===b[1]||"undefined"===b[1]?!1:!0);a="";a+="<div>";a+='<input type="radio"'+(e?' checked="checked"':"")+' name="radio_'+d+'" />';a+='<input type="text" value="'+f+'" />';a+='<a href="#" class="remove" title="'+c.messages.remove_message+'">'+c.messages.remove+"</a>";return a+="</div>"},m=function(e,d,g){g&&(g=
"checked"===g?!0:!1);d=""+('<li id="frm-'+h+'-item" class="'+j+'">');d=d+'<div class="legend">'+('<a id="frm-'+h+'" class="toggle-form" href="#">'+c.messages.hide+"</a> ");d+='<a id="del_'+h+'" class="del-button delete-confirm" href="#" title="'+c.messages.remove_message+'"><span>'+c.messages.remove+"</span></a>";d+='<strong id="txt-title-'+h+'">'+e+"</strong></div>";d+='<div id="frm-'+h+'-fld" class="frm-holder">';d=d+'<div class="frm-elements">'+('<div class="frm-fld"><label for="required-'+h+'">'+
c.messages.required+"</label>");d+='<input class="required" type="checkbox" value="1" name="required-'+h+'" id="required-'+h+'"'+(g?' checked="checked"':"")+" /></div>";d+=a;b(f).append(d+"</div></div></li>");b("#frm-"+h+"-item").hide();b("#frm-"+h+"-item").animate({opacity:"show",height:"show"},"slow");h++};b(".remove").live("click",function(){b(this).parent("div").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"fast",function(){b(this).remove()});return!1});b(".toggle-form").live("click",
function(){var a=b(this).attr("id");if(b(this).html()===c.messages.hide)return b(this).removeClass("open").addClass("closed").html(c.messages.show),b("#"+a+"-fld").animate({opacity:"hide",height:"hide"},"slow"),!1;b(this).html()===c.messages.show&&(b(this).removeClass("closed").addClass("open").html(c.messages.hide),b("#"+a+"-fld").animate({opacity:"show",height:"show"},"slow"));return!1});b(".delete-confirm").live("click",function(){var a=b(this).attr("id").replace(/del_/,"");confirm(b(this).attr("title"))&&
b("#frm-"+a+"-item").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"slow",function(){b(this).remove()});return!1});b(".add_ck").live("click",function(){b(this).parent().before(n());return!1});b(".add_opt").live("click",function(){b(this).parent().before(k(""));return!1});b(".add_rd").live("click",function(){b(this).parent().before(k(!1,b(this).parents(".frm-holder").attr("id")));return!1});var s=function(){c.save_url&&b.ajax({type:"POST",url:c.save_url,data:b(f).serializeFormList({prepend:c.serialize_prefix})+
"&form_id="+l,success:function(){}})}})}})(jQuery);
(function(b){b.fn.serializeFormList=function(j){var c=b.extend({prepend:"ul",is_child:!1,attributes:["class"]},j);if(!c.is_child)c.prepend="&"+c.prepend;var e="";this.each(function(){var f=0,a=1;b(this).children().each(function(){for(att=0;att<c.attributes.length;att++)if(e+=c.prepend+"["+f+"]["+("class"===c.attributes[att]?"cssClass":c.attributes[att])+"]="+encodeURIComponent(b(this).attr(c.attributes[att])),"class"===c.attributes[att])switch(e+=c.prepend+"["+f+"][required]="+encodeURIComponent(b("#"+
b(this).attr("id")+" input.required").attr("checked")),b(this).attr(c.attributes[att])){case "input_text":e+=c.prepend+"["+f+"][values]="+encodeURIComponent(b("#"+b(this).attr("id")+" input[type=text]").val());break;case "textarea":e+=c.prepend+"["+f+"][values]="+encodeURIComponent(b("#"+b(this).attr("id")+" input[type=text]").val());break;case "checkbox":a=1;b("#"+b(this).attr("id")+" input[type=text]").each(function(){"title"===b(this).attr("name")?e+=c.prepend+"["+f+"][title]="+encodeURIComponent(b(this).val()):
(e+=c.prepend+"["+f+"][values]["+a+"][value]="+encodeURIComponent(b(this).val()),e+=c.prepend+"["+f+"][values]["+a+"][baseline]="+b(this).prev().attr("checked"));a++});break;case "radio":a=1;b("#"+b(this).attr("id")+" input[type=text]").each(function(){"title"===b(this).attr("name")?e+=c.prepend+"["+f+"][title]="+encodeURIComponent(b(this).val()):(e+=c.prepend+"["+f+"][values]["+a+"][value]="+encodeURIComponent(b(this).val()),e+=c.prepend+"["+f+"][values]["+a+"][baseline]="+b(this).prev().attr("checked"));
a++});break;case "select":a=1,e+=c.prepend+"["+f+"][multiple]="+b("#"+b(this).attr("id")+" input[name=multiple]").attr("checked"),b("#"+b(this).attr("id")+" input[type=text]").each(function(){"title"===b(this).attr("name")?e+=c.prepend+"["+f+"][title]="+encodeURIComponent(b(this).val()):(e+=c.prepend+"["+f+"][values]["+a+"][value]="+encodeURIComponent(b(this).val()),e+=c.prepend+"["+f+"][values]["+a+"][baseline]="+b(this).prev().attr("checked"));a++})}f++})});return e}})(jQuery);